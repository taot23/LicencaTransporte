âœ… Objetivo da VerificaÃ§Ã£o
Durante a solicitaÃ§Ã£o de uma AET:

Ao selecionar um estado, o sistema:

Checa se jÃ¡ existe alguma licenÃ§a vigente e emitida relacionada Ã quela placa (cavalo e da linha de frente carretas) para o mesmo estado

Se existir e o vencimento for superior a 30 dias, o estado:

âš ï¸ Aparece em amarelo (atenÃ§Ã£o)

âŒ Ã‰ bloqueado para seleÃ§Ã£o

ğŸ“… Mostra a data de vencimento da licenÃ§a vigente

ğŸ§© Estrutura Base para Consulta
Consulta no backend:

sql
Copiar
Editar
SELECT *
FROM licencas_emitidas
WHERE estado = :estadoSelecionado
AND status = 'Emitida'
AND data_validade > CURRENT_DATE
AND (
  placa_unidade_tratora = :placa OR
  placa_primeira_carreta = :placa OR
  placa_segunda_carreta = :placa OR
  placa_dolly = :placa OR
  placa_prancha = :placa OR
  placa_reboque = :placa
)
ORDER BY data_validade DESC
LIMIT 1;
ğŸ”„ Passo a Passo: VerificaÃ§Ã£o Inteligente
ğŸ§  1. Captura das Placas
No formulÃ¡rio de solicitaÃ§Ã£o, tenha os campos:

ts
Copiar
Editar
const placas = {
  cavalo: "ABC1D23",
  primeiraCarreta: "DEF2E45",
  segundaCarreta: "GHI3F67",
  dolly: "JKL4G89",
  prancha: null,
  reboque: null
};
ğŸŒ 2. Ao Selecionar um Estado
A cada estado adicionado, chame:

ts
Copiar
Editar
async function verificarEstadoComLicencaVigente(estado, placas) {
  const res = await fetch('/api/licencas-vigentes', {
    method: 'POST',
    body: JSON.stringify({ estado, placas })
  });

  const licenca = await res.json();

  if (licenca && diasRestantes(licenca.data_validade) > 30) {
    marcarEstadoComoBloqueado(estado, licenca);
  }
}
ğŸ›‘ 3. Marcar Estado como Bloqueado
ts
Copiar
Editar
function marcarEstadoComoBloqueado(estado, licenca) {
  setEstadosBloqueados((prev) => ({
    ...prev,
    [estado]: {
      numero: licenca.numero_licenca,
      validade: licenca.data_validade
    }
  }));
}
ğŸ–¼ï¸ 4. RenderizaÃ§Ã£o visual no select de estados
jsx
Copiar
Editar
<CheckboxList>
  {estados.map((estado) => {
    const bloqueado = estadosBloqueados[estado];
    return (
      <div key={estado} className={`p-2 rounded border ${
        bloqueado ? 'border-yellow-400 bg-yellow-100 cursor-not-allowed' : ''
      }`}>
        <label>
          <input
            type="checkbox"
            disabled={!!bloqueado}
            value={estado}
          />
          {estado}
          {bloqueado && (
            <div className="text-sm text-yellow-600 mt-1">
              LicenÃ§a vigente atÃ© {formatarData(bloqueado.validade)}<br />
              NÂº {bloqueado.numero}
            </div>
          )}
        </label>
      </div>
    );
  })}
</CheckboxList>
âœ… Exemplo visual final:
plaintext
Copiar
Editar
â˜‘ SP
   (LicenÃ§a vigente atÃ© 12/08/2025 â€” NÂº AET-014587)
   [ Estado desabilitado com fundo amarelo ]
ğŸ§  BenefÃ­cios dessa abordagem
âœ… Evita duplicidade de licenÃ§as ativas para o mesmo estado

âœ… DÃ¡ transparÃªncia ao usuÃ¡rio sobre o motivo do bloqueio

âœ… Melhora a usabilidade com alertas visuais claros

âœ… Pronto para ser reutilizado para qualquer tipo de composiÃ§Ã£o