valida√ß√£o inteligente

‚úÖ Valida√ß√£o: Verifica√ß√£o de Licen√ßas Vigentes por Estado
üéØ Objetivo
Ao selecionar um estado no momento de solicita√ß√£o de nova AET, o sistema deve:

Verificar se j√° existe uma licen√ßa ativa (vigente) associada:

√Ä placa do Cavalo

√Ä placa da Linha de Frente

Para o mesmo estado selecionado

Com mais de 30 dias at√© o vencimento

Se sim:

‚ö†Ô∏è Mostrar modal de alerta com os dados da licen√ßa vigente

‚ùå Bloquear a sele√ß√£o daquele estado

üîÑ Fluxo de Verifica√ß√£o
Usu√°rio seleciona um ou mais estados no campo de "Abrang√™ncia"

Para cada estado selecionado, o sistema executa:

ts
Copiar
Editar
buscarLicencaVigente(placa, estado)
Se encontrar uma licen√ßa vigente com vencimento > hoje + 30 dias, exibe alerta

Estado √© removido ou desmarcado automaticamente

üß† L√≥gica da Verifica√ß√£o (Pseudoc√≥digo)
ts
Copiar
Editar
async function verificarEstadosSelecionados(estadosSelecionados, cavalo, linhaFrente) {
  for (const estado of estadosSelecionados) {
    const licenca = await buscarLicencaVigente([cavalo, linhaFrente], estado);

    if (licenca && diasRestantes(licenca.vencimento) > 30) {
      mostrarModalAlertaLicenca(licenca);
      removerEstadoSelecionado(estado);
    }
  }
}
üì¶ Estrutura esperada da fun√ß√£o buscarLicencaVigente
ts
Copiar
Editar
async function buscarLicencaVigente(placas: string[], estado: string) {
  return await Licenca.findOne({
    placa: { $in: placas },
    estado,
    status: 'Emitida',
    data_validade: { $gt: new Date() }
  }).sort({ data_validade: -1 });
}
üßæ Exemplo de Modal de Alerta
tsx
Copiar
Editar
<Modal isOpen={true}>
  <h2 className="text-yellow-600 font-bold">Aten√ß√£o</h2>
  <p>J√° existe uma licen√ßa ativa para este estado:</p>
  <p><strong>Licen√ßa:</strong> AET-015476</p>
  <p><strong>Vencimento:</strong> 28/07/2025</p>
  <p>N√£o √© permitido solicitar novamente at√© o vencimento se faltam mais de 30 dias.</p>
  <button onClick={fecharModal}>Entendi</button>
</Modal>
üé® Comportamento Visual
Estado que foi rejeitado deve ser:

Removido da lista (se m√∫ltiplos)

Ou marcado como inv√°lido no select (com vermelho ou aviso)

Modal em amarelo (aten√ß√£o), n√£o erro

‚úÖ Resumo das Regras T√©cnicas
Regra	Valor
Verifica cavalo + linha de frente	Sim
Estado	O estado selecionado na nova licen√ßa
Vencimento da licen√ßa existente	Deve ser maior que hoje + 30 dias
Status da licen√ßa existente	Apenas Emitida
Resultado	Bloquear estado + exibir modal